{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Represents a user account in the E&F WorkBee application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "role": {
          "type": "string",
          "description": "Role of the user (Worker, Customer, Admin).",
          "format": "enum",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserAccount 1:1 UserProfile)"
        }
      },
      "required": [
        "id",
        "email",
        "role",
        "createdAt",
        "userProfileId"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Stores common profile information for both Workers and Customers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user profile."
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the user."
        },
        "profilePhoto": {
          "type": "string",
          "description": "URL or path to the user's profile photo.",
          "format": "uri"
        },
        "locationLatitude": {
          "type": "number",
          "description": "Latitude of the user's location."
        },
        "locationLongitude": {
          "type": "number",
          "description": "Longitude of the user's location."
        },
        "address": {
          "type": "string",
          "description": "Address of the user's location"
        },
        "userAccountId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:1 UserProfile)"
        },
        "bio": {
          "type": "string",
          "description": "A short bio about the user."
        }
      },
      "required": [
        "id",
        "fullName",
        "userAccountId"
      ]
    },
    "WorkerProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "WorkerProfile",
      "type": "object",
      "description": "Stores additional profile information specific to workers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the worker profile."
        },
        "governmentIdUrl": {
          "type": "string",
          "description": "URL or path to the government-issued ID image.",
          "format": "uri"
        },
        "cvUrl": {
          "type": "string",
          "description": "URL or path to the worker's CV document.",
          "format": "uri"
        },
        "certificatesUrl": {
          "type": "string",
          "description": "URL or path to the worker's certificates document.",
          "format": "uri"
        },
        "videoUrl": {
          "type": "string",
          "description": "URL or path to the worker's work video.",
          "format": "uri"
        },
        "availability": {
          "type": "string",
          "description": "Worker's availability information (e.g., days and hours available)."
        },
        "status": {
          "type": "string",
          "description": "Status of the worker profile (Pending Approval, Approved, Suspended, Blocked)."
        },
        "skillCategoryIds": {
          "type": "array",
          "description": "References to SkillCategory. (Relationship: WorkerProfile N:N SkillCategory)",
          "items": {
            "type": "string"
          }
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: WorkerProfile 1:1 UserProfile)"
        },
        "averageRating": {
          "type": "number",
          "description": "The worker's average rating."
        },
        "reviewsCount": {
          "type": "number",
          "description": "The total number of reviews the worker has received."
        },
        "completedJobsCount": {
          "type": "number",
          "description": "The total number of jobs completed by the worker."
        }
      },
      "required": [
        "id",
        "availability",
        "status",
        "skillCategoryIds",
        "userProfileId"
      ]
    },
    "CustomerProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CustomerProfile",
      "type": "object",
      "description": "Stores additional profile information specific to customers.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer profile."
        },
        "isVerified": {
          "type": "boolean",
          "description": "Indicates whether the customer account is verified."
        },
        "userProfileId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: CustomerProfile 1:1 UserProfile)"
        },
        "averageRating": {
          "type": "number",
          "description": "The customer's average rating."
        },
        "reviewsCount": {
          "type": "number",
          "description": "The total number of reviews the customer has received."
        }
      },
      "required": [
        "id",
        "isVerified",
        "userProfileId"
      ]
    },
    "SkillCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SkillCategory",
      "type": "object",
      "description": "Represents a skill category that a worker can possess.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the skill category."
        },
        "name": {
          "type": "string",
          "description": "Name of the skill category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "type": "object",
      "description": "Represents a chat conversation between two or more users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the conversation."
        },
        "participantIds": {
          "type": "array",
          "description": "Array of user account IDs participating in the conversation.",
          "items": {
            "type": "string"
          }
        },
        "lastMessage": {
          "type": "string",
          "description": "A snippet of the last message for display in conversation lists."
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the last activity in the conversation."
        }
      },
      "required": [
        "id",
        "participantIds",
        "updatedAt"
      ]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single message within a conversation.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message."
        },
        "conversationId": {
          "type": "string",
          "description": "The ID of the conversation this message belongs to."
        },
        "senderId": {
          "type": "string",
          "description": "The user account ID of the message sender."
        },
        "content": {
          "type": "string",
          "description": "The text content of the message, or description for a proposal."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the message was sent."
        },
        "contentType": {
          "type": "string",
          "description": "Type of the message content (e.g., text, price proposal).",
          "enum": [
            "text",
            "proposal",
            "system"
          ]
        },
        "proposalAmount": {
          "type": "number",
          "description": "The amount for a price proposal. Only present if contentType is 'proposal'."
        },
        "proposalStatus": {
          "type": "string",
          "description": "The status of a price proposal. Only present if contentType is 'proposal'.",
          "enum": [
            "pending",
            "accepted",
            "countered",
            "rejected"
          ]
        },
        "jobId": {
          "type": "string",
          "description": "Reference to the Job created from an accepted proposal."
        }
      },
      "required": [
        "id",
        "conversationId",
        "senderId",
        "content",
        "createdAt",
        "contentType"
      ]
    },
    "Job": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Job",
      "type": "object",
      "description": "Represents a job created from an accepted price proposal, tracking its state from payment to completion.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the job, typically matching the accepted proposal message ID."
        },
        "jobPostingId": {
          "type": "string",
          "description": "Optional reference to the JobPosting this job originated from."
        },
        "title": {
          "type": "string",
          "description": "The title of the job."
        },
        "customerId": {
          "type": "string",
          "description": "The user ID of the customer who is paying for the job."
        },
        "workerId": {
          "type": "string",
          "description": "The user ID of the worker performing the job."
        },
        "conversationId": {
          "type": "string",
          "description": "The conversation where the job was agreed upon."
        },
        "description": {
          "type": "string",
          "description": "The description of the job from the proposal."
        },
        "price": {
          "type": "number",
          "description": "The agreed-upon price for the job, excluding fees."
        },
        "serviceFee": {
          "type": "number",
          "description": "The service fee charged by the platform."
        },
        "totalAmount": {
          "type": "number",
          "description": "The total amount to be paid by the customer (price + serviceFee)."
        },
        "status": {
          "type": "string",
          "description": "The current status of the job.",
          "enum": [
            "AwaitingPayment",
            "PaymentSecured",
            "Completed",
            "Disputed",
            "Cancelled"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the job was created."
        },
        "paidAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the payment was secured."
        },
        "completedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the job was marked as completed."
        }
      },
      "required": [
        "id",
        "title",
        "customerId",
        "workerId",
        "conversationId",
        "price",
        "serviceFee",
        "totalAmount",
        "status",
        "createdAt"
      ]
    },
    "JobPosting": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JobPosting",
      "type": "object",
      "description": "Represents a job or errand posted by a customer, available for workers to apply.",
      "properties": {
        "id": {
          "type": "string"
        },
        "customerId": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "skillCategoryIds": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "locationLatitude": {
          "type": "number"
        },
        "locationLongitude": {
          "type": "number"
        },
        "address": {
          "type": "string"
        },
        "jobType": {
          "type": "string",
          "enum": [
            "one-time",
            "recurring",
            "errand"
          ]
        },
        "status": {
          "type": "string",
          "enum": [
            "open",
            "assigned",
            "completed",
            "cancelled"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "customerId",
        "title",
        "description",
        "skillCategoryIds",
        "status",
        "createdAt"
      ]
    },
    "JobApplication": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JobApplication",
      "type": "object",
      "description": "Represents a worker's application for a specific job posting.",
      "properties": {
        "id": {
          "type": "string"
        },
        "jobPostingId": {
          "type": "string"
        },
        "workerId": {
          "type": "string"
        },
        "customerId": {
          "type": "string"
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "accepted",
            "rejected"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "jobPostingId",
        "workerId",
        "customerId",
        "status",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/userAccounts/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. The 'role' field is stored directly within the document for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user account."
            }
          ]
        }
      },
      {
        "path": "/userProfiles/{userProfileId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores common user profile information for both workers and customers.",
          "params": [
            {
              "name": "userProfileId",
              "description": "The unique identifier of the user profile."
            }
          ]
        }
      },
      {
        "path": "/workerProfiles/{workerProfileId}",
        "definition": {
          "entityName": "WorkerProfile",
          "schema": {
            "$ref": "#/backend/entities/WorkerProfile"
          },
          "description": "Stores worker-specific profile information, including government ID, CV, video, availability, skill categories, and status. Includes the 'status' field for authorization independence.",
          "params": [
            {
              "name": "workerProfileId",
              "description": "The unique identifier of the worker profile."
            }
          ]
        }
      },
      {
        "path": "/customerProfiles/{customerProfileId}",
        "definition": {
          "entityName": "CustomerProfile",
          "schema": {
            "$ref": "#/backend/entities/CustomerProfile"
          },
          "description": "Stores customer-specific profile information, including verification status. Includes the 'isVerified' field for authorization independence.",
          "params": [
            {
              "name": "customerProfileId",
              "description": "The unique identifier of the customer profile."
            }
          ]
        }
      },
      {
        "path": "/skillCategories/{skillCategoryId}",
        "definition": {
          "entityName": "SkillCategory",
          "schema": {
            "$ref": "#/backend/entities/SkillCategory"
          },
          "description": "Stores information about skill categories.",
          "params": [
            {
              "name": "skillCategoryId",
              "description": "The unique identifier of the skill category."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "admin",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Indicates admin role. Existence of the document grants admin privileges. No content required. Relies on existence over content.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the admin user."
            }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": {
            "$ref": "#/backend/entities/Conversation"
          },
          "description": "Stores conversation metadata.",
          "params": [
            {
              "name": "conversationId",
              "description": "The unique identifier of the conversation."
            }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}/messages/{messageId}",
        "definition": {
          "entityName": "ChatMessage",
          "schema": {
            "$ref": "#/backend/entities/ChatMessage"
          },
          "description": "Stores all messages for a specific conversation.",
          "params": [
            {
              "name": "conversationId",
              "description": "The unique identifier of the conversation."
            },
            {
              "name": "messageId",
              "description": "The unique identifier of the message."
            }
          ]
        }
      },
      {
        "path": "/jobs/{jobId}",
        "definition": {
          "entityName": "Job",
          "schema": {
            "$ref": "#/backend/entities/Job"
          },
          "description": "Stores job details after a price proposal is accepted. Tracks payment and completion status.",
          "params": [
            {
              "name": "jobId",
              "description": "The unique identifier of the job."
            }
          ]
        }
      },
      {
        "path": "/jobPostings/{jobPostingId}",
        "definition": {
          "entityName": "JobPosting",
          "schema": {
            "$ref": "#/backend/entities/JobPosting"
          },
          "description": "Stores all job postings created by customers."
        }
      },
      {
        "path": "/jobPostings/{jobPostingId}/applications/{applicationId}",
        "definition": {
          "entityName": "JobApplication",
          "schema": {
            "$ref": "#/backend/entities/JobApplication"
          },
          "description": "Stores all applications submitted by workers for a job posting."
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support E&F WorkBee's user account system, role-based access control, and onboarding processes while adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. It prioritizes security, scalability, and debuggability.\n\n**Authorization Independence:**\n\n*   **`userAccounts`**: Each `UserAccount` document contains a `userProfileId`, establishing a 1:1 relationship with the `userProfiles` collection. The `role` field is stored directly within the `UserAccount` document, enabling role-based access control without requiring `get()` calls to other collections.\n*   **`workerProfiles`**: `WorkerProfile` documents include the `userProfileId` to link to common profile data, and maintain their approval `status`. No `get()` calls are required to determine a Worker's approval status and permissions.  The `skillCategoryIds` array within the `WorkerProfile` allows direct association with skill categories, and can be used for filtering/matching.\n*   **`customerProfiles`**: Similarly, `CustomerProfile` documents store `isVerified` status, making it immediately accessible without external lookups.\n\n**Structural Segregation:**\n\n*   **Separate Collections for Roles**: The structure uses distinct collections (`userAccounts`, `userProfiles`, `workerProfiles`, `customerProfiles`) to segregate data based on its security posture and access requirements. This prevents mixing data with differing access needs within the same collection.\n*   **Admin Approval**: The `/roles_admin/{uid}` collection is used for managing admin roles. The existence of a document in this collection grants admin privileges. This approach avoids embedding role information within user documents, simplifying rules and improving security.\n\n**Access Modeling:**\n\n*   **Path-Based Ownership**: The primary access control mechanism is path-based ownership, especially within the `userAccounts` collection. Security rules can easily verify if `request.auth.uid` matches the `{userId}` in the path.\n*   **DBAC (Database-Based Access Control)**: The `roles_admin` collection implements DBAC, with role assignment determined by the presence of a document keyed by the user's UID. This approach avoids the complexity and potential security risks of custom claims.\n\n**QAPs (Rules are not Filters):**\n\nThe structural segregation supports secure `list` operations (QAPs). Admins can `list` all `workerProfiles` to review applications. Customers can `list` `workerProfiles` that are `Approved` and match certain skills, because the necessary authorization and filter criteria are present without requiring complex `get()` calls.  The separation of user profiles into distinct collections based on role allows for tailored listing permissions.\n\nThis design facilitates simple, robust, and easily debuggable security rules. The denormalization strategy eliminates the need for `get()` calls in security rules, improving performance and preventing cascading failures. The segregation of data based on role simplifies rule definitions and enhances security. The explicit state modeling and predictable schema improve data clarity and maintainability."
  }
}

    